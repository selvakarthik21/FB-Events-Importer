function handleClientLoad(){console.log("hi"),gapi.client.setApiKey(apiKey),window.setTimeout(checkAuth,1)}function checkAuth(){gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!0},handleAuthResult)}function handleAuthClick(){return gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!1},handleAuthResult),!1}function handleAuthResult(e){e&&!e.error?(loadGmailApi(),$("#authorize-button").remove(),$(".table-inbox").removeClass("hidden"),$("#compose-button").removeClass("hidden")):($("#authorize-button").removeClass("hidden"),$("#authorize-button").on("click",function(){handleAuthClick()}))}function loadGmailApi(){gapi.client.load("gmail","v1",listLabels)}function listLabels(){gapi.client.gmail.users.labels.list({userId:userId}).execute(function(e){var t=e.labels;$.each(t,function(e,t){"user"==t.type&&(userLabel[t.name]=t.id)})})}function listMessages(){var e=loadAllMessages;handleClientLoad(),$(".table-inbox tbody").empty(),toBeRemovedLabels=[],toBeRemovedLabelIds=[];var t=$.trim($("#query").val());if(t.length<1)alert("Please enter the Search query");else{$.each(t.split(" "),function(e,t){var a=t||"";if((a=$.trim(a).toLowerCase()).indexOf("label:")>-1){var o=a.replace(/label\:/gi,"");for(var s in userLabel)if(s.toLowerCase()==o){toBeRemovedLabels.push(s),toBeRemovedLabelIds.push(userLabel[s]);break}if(o.indexOf("-")>0){o=o.replace(/-/gi," ");for(var s in userLabel)if(s.toLowerCase()==o){toBeRemovedLabels.push(s),toBeRemovedLabelIds.push(userLabel[s]);break}}}});var a=function(o,s){o.execute(function(n){s=n.messages;var i=n.nextPageToken;e(s),i&&(o=gapi.client.gmail.users.messages.list({userId:userId,pageToken:i,q:t}),a(o,s))})},o=gapi.client.gmail.users.messages.list({userId:userId,q:t});a(o,[])}}function loadAllMessages(e){$.each(e,function(e,t){gapi.client.gmail.users.messages.get({userId:"me",id:this.id}).execute(function(e){removeLabel(e,e.payload)})}),null!=e&&0!=e.length||appendNoData()}function removeLabel(e,t){gapi.client.gmail.users.messages.modify({userId:userId,id:e.id,removeLabelIds:toBeRemovedLabelIds}).execute(function(e){appendMessageRow(e,t)})}function appendNoData(){$(".table-inbox tbody").empty();var e=$(".table-inbox thead th").length;$(".table-inbox tbody").append('<tr>\t\t\t<td colspan="'+e+'" style="text-align:center;"> No Data Available</td>\t\t\t</tr>')}function appendMessageRow(e,t){var a=[];$.each(e.labelIds,function(e,t){console.log(t),console.log(userLabel.getKeyByValue(t));var o=userLabel.getKeyByValue(t)||t;console.log(o),a.push(o)}),$(".table-inbox tbody").append("<tr>\t\t\t<td>"+getHeader(t.headers,"From")+"</td>\t\t\t<td>"+getHeader(t.headers,"Subject")+"</td>\t\t\t<td>"+a.toString()+"</td>\t\t\t<td>"+toBeRemovedLabels.toString()+"</td>\t\t\t</tr>")}function getHeader(e,t){var a="";return $.each(e,function(){this.name.toLowerCase()===t.toLowerCase()&&(a=this.value)}),a}function getBody(e){var t="";return t=void 0===e.parts?e.body.data:getHTMLPart(e.parts),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),decodeURIComponent(escape(window.atob(t)))}function getHTMLPart(e){for(var t=0;t<=e.length;t++){if(void 0!==e[t].parts)return getHTMLPart(e[t].parts);if("text/html"===e[t].mimeType)return e[t].body.data}return""}var clientId="118625724860-lf6mgu8bu61npvv9e2a6jp7o3tkars1p.apps.googleusercontent.com",apiKey="AIzaSyCnvRHxn9BKaUyvREdRJgXtBYZ4Cj4BZjw",scopes="https://www.googleapis.com/auth/gmail.modify",userId="me",userLabel={},toBeRemovedLabels=[],toBeRemovedLabelIds=[];$(document).ready(function(){$("#RemoveLabels").click(listMessages),$("#query").keydown(function(e){if(13==e.keyCode)return e.preventDefault(),listMessages(),!1})}),Object.prototype.getKeyByValue=function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]===e)return t};